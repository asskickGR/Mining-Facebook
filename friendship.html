<!DOCTYPE html>
<html>
  <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->   
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=medium-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title>Mining Social Web</title>
		</head>
    
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/facebookConnectPlugin.js"></script>
    <script src="js/jquery-1.7.2.min.js"></script>
    <script src="js/postfriends.js"></script>
	<script type="text/javascript" charset="utf-8">

        
    // Wait for device API libraries to load
    function onLoad() {
        document.addEventListener("deviceready", onDeviceReady, false);
    }
        
    
    
    ///////////// device APIs are available //////////////////
    function onDeviceReady() {
        // Now safe to use device APIs
        
		 facebookConnectPlugin.api( "me?fields=friends.limit(1000)", ["user_birthday"], 
            function (response) { 
               
                document.getElementById('user_a').value = response.id;
                var buttons = document.getElementById('btns');
                
                for (var i=0; i < response.friends.data.length; i++) {
                    
                    var btn = document.createElement('div');
                    btn.className="event listening button";
                    //btn.onclick=selectFriend();
                    btn.id=response.friends.data[i].id;
                    btn.name=response.friends.data[i].name;
                    btn.setAttribute("onclick","selectFriend(this.id , this.name)");
                    btn.innerHTML= response.friends.data[i].name;
                    buttons.appendChild(btn);   
                }
                alert(JSON.stringify(response.friends.data.length)+"/"+ JSON.stringify(response.friends.summary.total_count) + " friends use the app.");
            },
                    
            function (response) {  alert("Something went wrong.");    }  ); 
        
        
        var qs = new Querystring();
        var v1 = qs.get("name");
        alert(v1);
        
    }
	////////////////////////////////////////////////////////////
        
        
        
        
    document.addEventListener('backbutton', function(e){
            window.location = "menu.html";
    }, false);
                
        
        
    var  callAnotherPage = function () {
        window.location = "menu.html";
    }
    
    
    
    $(document).on('click', '#logout', function(){
    facebookConnectPlugin.logout( 
                    function (response) { alert("Good bye!") 
					window.location = "index.html";
					},
                    function (response) { alert(JSON.stringify(response)) });
    });
    
    
        
        
        
        
        
    ///////////////////////////////////////////////////////////    
    var  selectFriend = function (id,name) {
              
        //window.location = "friendship.html?id=".id."&name=".name;
        
        
        
        
        //find common friends
        facebookConnectPlugin.api( id+"?fields=context{mutual_friends}", ["user_birthday"],
            function (response) { 
        //alert("You have "+JSON.stringify(response.context.mutual_friends.summary.total_count)+" common friends with "+name+".");
                document.getElementById('friends').value = response.context.mutual_friends.summary.total_count;
            },
                    
            function (response) {  alert("Something went wrong.");    }  ); 
             
             
            document.getElementById('user_b').value = id;
            // document.getElementById('common_music').value = NULL;
            // document.getElementById('common_movies').value = NULL;
             
             
             setTimeout(function(){
                $('#users').submit();
             }, 1000);
             
             alert("form submitted");
             
             
             
             
    }
    //////////////////////////////////////////////////////////////
        
    </script>
    
      
      
    
    
    
    
    
  <body onload="onLoad()">
      <div class="app">
          <h1>Mining Facebook
              Friendship</h1>
          
            
          <div style="margin: 10px 10px 40px 0;" class="event listening button" onclick="callAnotherPage();">Menu</div>
          
          <!--buttons with friends-->
          <div id="btns"></div>
          
          
          
          <!--
            form with friendship data


            style="display:none"
            -->
          
          
            <form name="users" id="users" style="display:none">
		      <label for="user_a">
			     <b>user_a</b>
			     <input id="user_a" name="user_a">
		      </label>

		      <label for="user_b">
			     <b>user_b</b>
			     <input id="user_b" name="user_b">
		      </label>
                
              <label for="common_music">
			     <b>common_music</b>
			     <input id="common_music" name="common_music">
		      </label>
                
                <label for="common_movies">
			     <b>common_movies</b>
			     <input id="common_movies" name="common_movies">
		      </label>
                
                <label for="friends">
			     <b>friends</b>
			     <input id="friends" name="friends">
		      </label>
		
		      <input type="submit" value="Send data">
              
	       </form> 
          
          
          
          
          
                    
          
          
      </div>
      
      
  </body>
</html>
