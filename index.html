<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=medium-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title>Mining Facebook</title>
        
     </head>
        
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/facebookConnectPlugin.js"></script>
		<script src="js/jquery-1.7.2.min.js"></script>
		<script src="js/postlogin.js"></script>
        <script src="js/dynamicpage.js"></script>
    <script type="text/javascript" src="js/notify.js.sdx"></script>
        <script type="text/javascript"  charset="utf-8">
            
            
            function onLoad() {
                document.addEventListener("deviceready", onDeviceReady, false);
                document.addEventListener('backbutton', function(e){
                      if (confirm("Do you want to exit?"))  
                      {
                        navigator.app.exitApp();
                      }
                    else
                      {
                        
                      }
            }, false);
            }
            
            
            
            function onDeviceReady() {
             
                facebookConnectPlugin.getLoginStatus( 
                    function (response) { 
                        if (response.status == 'connected') {
                            $.notify(response.status, "success");
                            changePage("menu.html");
                        }
                        else 
                            $.notify("disconnected", "info");
                    },
                    function (response) { alert(JSON.stringify(response)) });
                
            }
            
            
            
            
            
            
            $(document).on('click', '#login', function(){
                
                // $.notify("Login: successful", "success");
                
                if (!window.cordova) {
                    var appId = prompt("Enter FB Application ID", "");
                    facebookConnectPlugin.browserInit(appId);
                }
                
                
                
                facebookConnectPlugin.login( ["email,user_friends,user_actions.music,user_likes,user_birthday"], 
                    function (response) { 
                        //status=true;
                        //alert('Login: successful');
                        $.notify("Login: successful", "success");
                        loggedin();
                    },
                    function (response) { 
                        //alert(JSON.stringify(response)) 
                        $.notify("Something went wrong.\nPlease try again.", "warn");  
                    }
                );
                
                    
             });
            
            
            
            function loggedin() {
                    
                //alert('loggedin');
                
                if (document.getElementById("update").checked === true) {
                    
                
                    ///////////////////////update personal data/////////////////////////
                        facebookConnectPlugin.api( "me?fields=id,name,first_name,last_name,email", ["user_birthday"],
                            function (response) { 
                
                            document.getElementById('id').value = response.id;
                            document.getElementById('name').value = response.name;
                            document.getElementById('first').value = response.first_name;
                            document.getElementById('last').value = response.last_name;
                            document.getElementById('email').value = response.email;
                            
                            //alert("Your profile has been registered.");
                            $('#user').submit(); 
                            
                            
                            
                            //setTimeout(function() { 
                            changePage("music.html");
                              //  window.location = "music.html";
                            //}, 1000);
                            
                              
                                 
                            
                            },
                    
                            function (response) {  
                            alert("Something went wrong.\nPlease try again.");    
                            }  ); 
                        /////////////////////////////////////////////////
                    
                    }
                    else {  changePage("menu.html"); }
                
                    
                    
            }
            
            
          
        </script>
        
        
   
    <body onload="onLoad()">
      
        <div id="page">            
            <div id="fb-root"></div> 
               <div class="app"> 
        
             <h1>Mining Facebook<small>Graduate Thesis | <a href="index.html">View details</a></small></h1>
            
            
            <input type="checkbox" name="update" id="update" class="css-checkbox" /><label for="update" class="css-label">Update profile</label>
            
            
            <img id="login" src="img/login.png"/>
            
            
            <!--
               style="display:none"
            -->
            
            <form name="user" id="user" style="display:none">
		      <label for="id">
			     <b>id</b>
			     <input id="id" name="id">
		      </label>

		      <label for="name">
			     <b>name</b>
			     <input id="name" name="name">
		      </label>
              
              <label for="first">
			     <b>name</b>
			     <input id="first" name="first">
		      </label>
              
              <label for="last">
			     <b>name</b>
			     <input id="last" name="last">
		      </label>
              
              <label for="email">
			     <b>name</b>
			     <input id="email" name="email">
		      </label>
		
		      <input type="submit" value="Send data">
              
	       </form>  
             
            
            </div>
        
      </div>      
           
        
        
        
    </body>
</html>
